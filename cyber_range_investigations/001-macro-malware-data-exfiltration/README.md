# 001 – Macro Malware Data Exfiltration (Network Investigation)

**Case Title:** Macro Malware Data Exfiltration – Network Forensics  
**Case ID:** 001-macro-malware-data-exfiltration  
**Date Created:** 12-09-2025  
**Last Updated:** 12-09-2025  
**Author:** Ryan Valera  

## 1. Overview

### Objective
Analyze captured network traffic (PCAP) to:

- Confirm that a malicious macro executed and downloaded malware.  
- Reconstruct the sequence of events leading to unauthorized data exfiltration.  
- Identify indicators of compromise (IOCs), including malware delivery URLs, C2 infrastructure, DNS activity, and exfiltration channels.  

### Scenario Summary
A malicious macro embedded in a document triggered a malware download, which subsequently exfiltrated sensitive data to an external server. After the breach was detected, a packet capture (PCAP) was taken to preserve network evidence.

This investigation focuses solely on analyzing the PCAP to reconstruct the attack chain and identify how data was exfiltrated.

- **Source Platform:** CyberDefenders CyberRange  
- **Investigation Type:** Network Forensics (PCAP Analysis)  

### Key Questions
- What network indicators show the malicious macro downloading malware?  
- Which hosts (IP/ports) participated in command-and-control (C2) or data exfiltration?  
- Which protocols were used (HTTP, DNS, TLS, etc.)?  
- What IOCs (domains, IPs, URIs, hashes, artifacts) can be extracted from the traffic?  

---

## 2. Scope of This Repository

This repository contains the complete forensic workflow for Case 001 and is structured as follows:

cyberrange-net-investigation/
├── case-notes/ # Analyst notes, observations, timelines
├── evidence-metadata/ # Hashes, tool usage, acquisition metadata
├── pcaps/ # Stored PCAP(s) used in this investigation
├── analysis/ # NetFlow, Wireshark filters, Zeek/Suricata outputs
├── scripts/ # Helper scripts (Python, Bash, Zeek, etc.)
└── reports/ # Final report + any interim findings


### Purpose of This Structure
- Maintain **evidence integrity**  
- Keep all analysis **repeatable and documented**  
- Facilitate reconstruction of attacker behavior  
- Support a professional DFIR reporting workflow  

---

## 3. Current Evidence

### PCAP Evidence
- **File Name:** `final.pcap`  
- **Location:** `/home/ubuntu/Desktop/Start here/Artifacts/final.pcap`  
- **Repository Path:** `pcaps/final.pcap`  
- **Source:** CyberDefenders CyberRange  
- **Description:** Captured network traffic after macro-triggered malware infection resulting in data exfiltration.

Hashes, timestamps, and chain-of-custody details are stored in:

`evidence-metadata/001-tools-usage-documentation.md`

---

## 4. Tools, Frameworks & Infrastructure Observed

### Network / Packet / Flow Analysis
- **nfpcapd / nfdump** – Converts PCAP to NetFlow; identifies top talkers and flow anomalies  
- **Zeek** – Produces DNS, HTTP, connection, and file metadata  
- **Suricata** – IDS alerts including EXE downloads & suspicious DNS queries  
- **Zui** – Log pivoting and dataset exploration  
- **Wireshark** – Packet-level inspection & HTTP object extraction  
- **NetworkMiner** – Extracted EXE payloads, metadata, and credentials  

### Threat Intelligence
- **VirusTotal** – Malware reputation & behavioral analysis  
- **checkip.amazonaws.com** – External IP lookup behavior commonly used in malware  

### Observed Malicious / Relevant Domains
| Domain | Purpose |
|--------|---------|
| **microflash.no** | Malware delivery (`/includes/AL5THvvehvvvajyc.exe`) |
| **working-from-home.ga** → 89.46.222.42 | C2 + data exfil endpoint |
| **bbt.com** | Victim’s financial account access |
| **smtp.gmail.com** | Potential email-based exfil channel |

---

## 5. Planned Analysis Approach (High-Level)

### Phase 1 – Traffic Overview
- NetFlow generation  
- Identify top talkers, ports, protocols, and anomalies  

### Phase 2 – Malware Download Reconstruction
- DNS → HTTP GET sequence to `microflash.no`  
- Extract malware via NetworkMiner/Wireshark  
- Hash and submit to VirusTotal  

### Phase 3 – C2 and Exfil Analysis
- Identify communications with `working-from-home.ga` (89.46.222.42)  
- Determine exfil method (likely HTTP POST or long-duration TCP)  
- Quantify outbound data volume  

### Phase 4 – IOC Extraction
- Domains, IPs, JA3, URIs, User-Agents  
- File hashes from extracted artifacts  

### Phase 5 – MITRE ATT&CK Mapping
Likely techniques include:

- **T1566 — Phishing (macro lure)**  
- **T1204 — User Execution**  
- **T1105 — Ingress Tool Transfer**  
- **T1071 / T1041 — Web-based C2 and exfiltration**  

---

## 6. Documentation Process

As analysis progresses:

- Step-by-step reasoning is recorded in:  
  `case-notes/001-analysis-tools-and-methods.md`

- Tooling metadata & evidence integrity details appear in:  
  `evidence-metadata/001-tools-usage-documentation.md`

- Technical outputs (flows, queries, artifacts) are stored in:  
  `analysis/`

- Final narrative report will be written in:  
  `reports/001-macro-malware-data-exfiltration_Report.md`

---
