# 001 – Macro Malware Data Exfiltration (Network Investigation)

**Case Title:** Macro Malware Data Exfiltration – Network Forensics  
**Case ID:** 001-macro-malware-data-exfiltration  
**Date Created:** 12-09-2025  
**Last Updated:** 12-12-2025  
**Author:** Ryan Valera  
**Time Standard:** UTC  
**Source Platform:** CyberDefenders CyberRange  


## 1. Overview

### Objective
Analyze captured network traffic (PCAP) to:

- Identify the malware delivery mechanism and infection source.
- Reconstruct the attack chain leading to data exfiltration.
- Extract indicators of compromise (IOCs) and produce a defensible timeline.

### Scenario Summary
A malicious macro triggered the download of a Windows executable over HTTP. After infection, the compromised host exfiltrated data to an external server using FTP. This repository documents the full PCAP analysis workflow, findings, and supporting evidence.


## 2. Repository Structure
```
001-macro-malware-data-exfiltration/
├── README.md
├── case-notes/
│ ├── 001-analysis-tools-and-methods.md
│ └── 002-investigation-procedure-and-findings.md
├── evidence-metadata/
│ └── 001-tools-usage-documentation.md
├── analysis/
│ ├── 001-netflow-top-talkers.md
│ ├── 002-network-ioCs.md
│ └── 003-timeline-utc.md
└── reports/
└── 001-macro-malware-data-exfiltration_Report.md
```
## 3. Evidence

### PCAP
- **File Name:** `final.pcap`  
- **Source:** CyberDefenders CyberRange  
- **Notes:** PCAP stored/processed within the provided lab VM environment.


## 4. Confirmed Findings (Executive Summary)

| Category | Finding |
|---|---|
| Victim Host | `10.2.7.101` |
| Malware Delivery | `microflash.no` (`205.186.187.108:80`) |
| Payload URL | `http://microflash.no/includes/AL5THvvehvvvajyc.exe` |
| Payload SHA-256 | `72505cc347af0524c7f22ca97cb2547b7d51a1764ec43d1de7679c1072622c11` |
| Exfil Server | `89.46.222.42` |
| Exfil Protocol | FTP (`21/tcp` control; high ports for data) |
| Exfil Duration | `01:40:53` |
| VBS Artifact (sandbox) | `catsin.vbs` |
| Most Frequent Alert | `ET INFO DNS Query for Suspicious .ga Domain` |

## 5. Investigation Workflow (What Was Done)

### Step 1 – Flow Overview (NetFlow)
Converted PCAP → NetFlow (`nfpcapd`) and used `nfdump` to identify top talkers and byte-heavy flows.  
Results highlight:
- Large inbound HTTP transfer from `205.186.187.108` to victim (payload delivery)
- Repeated outbound transfers from victim to `89.46.222.42` consistent with exfiltration

See: `analysis/001-netflow-top-talkers.md`

### Step 2 – IDS and Log Pivoting (Suricata / Zeek / Zui)
Reviewed IDS alerts and correlated Zeek HTTP logs to validate malware download behavior:
- `ET POLICY PE EXE or DLL Windows file download HTTP`

See: `case-notes/002-investigation-procedure-and-findings.md`

### Step 3 – Packet Verification (Wireshark)
Verified HTTP GET request and full URL:
- `GET /includes/AL5THvvehvvvajyc.exe`
- Host: `microflash.no`

### Step 4 – Artifact Extraction + Hashing (NetworkMiner)
Extracted malware payload and computed SHA-256 hash:
- `72505cc347af0524c7f22ca97cb2547b7d51a1764ec43d1de7679c1072622c11`

### Step 5 – Exfiltration Validation (FTP)
Confirmed outbound FTP transfers to `89.46.222.42` including screenshots and a credential-recovery HTML.  
FTP control channel observed on `21/tcp` with successful `STOR` operations.

### Step 6 – Timeline + IOC Output
Produced a UTC-normalized timeline and IOC list for reporting.

See:
- `analysis/003-timeline-utc.md`
- `analysis/002-network-ioCs.md`

## 6. Reports

- Final report draft: `reports/001-macro-malware-data-exfiltration_Report.md`
